@use 'sass:color';

@use '@material/theme' with (
  $primary: #ffffffdb,
  $secondary: #0d47a1,
  $on-primary: #000000,
);

$headline-font-family: Montserrat, Roboto, sans-serif;

@use '@material/typography' with (
  $font-family: unquote('Roboto, sans-serif'),

  $styles-headline1: (font-family: $headline-font-family),
  $styles-headline2: (font-family: $headline-font-family),
  $styles-headline3: (font-family: $headline-font-family),
  $styles-headline4: (font-family: $headline-font-family),
  $styles-headline5: (font-family: $headline-font-family),
  $styles-headline6: (font-family: $headline-font-family),
  $styles-subtitle1: (font-family: $headline-font-family),
);

@use "@material/icon-button";
@use "@material/shape";

@use '@material/chips/mdc-chips';
@use '@material/drawer/mdc-drawer';
@use '@material/list/mdc-list';
@use '@material/theme/mdc-theme';
@use "@material/top-app-bar/mdc-top-app-bar";
@use '@material/typography/mdc-typography';

@use '@material/chips/mixins' as chip-mixins;
@use '@material/drawer/variables' as drawer-variables;
@use '@material/list/mixins' as list-mixins;
@use '@material/list/variables' as list-variables;
@use '@material/top-app-bar/variables' as top-app-bar-variables;
@use '@material/typography/mixins' as typography-mixins;

@use 'tobii/src/scss/tobii';

// Have to use @import here, because @use can't go in a media query
@media (prefers-color-scheme: light) {
  @import 'highlight.js/scss/github';
}
@media (prefers-color-scheme: dark) {
  @import 'highlight.js/scss/androidstudio';
}

:root {
  --warning-color: #5c00d2;
}

@media (prefers-color-scheme: dark) {
  $primary: #ffffffe0;
  $background: #171717;

  // XXX: This is all super ugly!
  :root {
    --mdc-theme-background: #{$background};
    --mdc-theme-secondary: #5882c2;
    --mdc-theme-on-primary: #{$primary};
    --mdc-theme-on-surface: #{$primary};

    --warning-color: #df55f2;
  }

  body,
  .mdc-drawer {
    background-color: var(--mdc-theme-background);
    color: var(--mdc-theme-on-primary);
  }

  .mdc-chip {
    // Based on how the official Sass rules handle this.
    @include chip-mixins.fill-color(color.mix($primary, $background, 12%));

    color: #ffffffb3;

    .mdc-chip__checkmark {
      // XXX: The color is hardcoded black in the SVG, so we flip it here.
      filter: invert(85%);
    }
  }

  .mdc-drawer {
    border-color: #ffffff1f;

    .mdc-drawer__title {
      color: #ffffffde;
    }

    .mdc-list-group__subheader {
      color: #ffffff99;
    }

    .mdc-list-item {
      color: #ffffffde;
    }
  }

  .mdc-top-app-bar {
    background-color: #171717f0;
    color: #ffffffde;
  }

  .mdc-icon-button::before,
  .mdc-icon-button::after,
  .mdc-chip .mdc-chip__ripple::before,
  .mdc-chip .mdc-chip__ripple::after,
  :not(.mdc-list-item--disabled).mdc-list-item .mdc-list-item__ripple::before,
  :not(.mdc-list-item--disabled).mdc-list-item .mdc-list-item__ripple::after {
    background-color: #fff !important;
  }

  .mdc-list-divider {
    border-bottom-color: #ffffff1f;
  }
}

@include icon-button.core-styles;

$mobile-breakpoint: 768px;

@mixin if-mobile {
  @media (max-width: $mobile-breakpoint - 1px) {
    @content;
  }
}

@mixin if-not-mobile {
  @media (min-width: $mobile-breakpoint) {
    @content;
  }
}

html {
  scroll-behavior: smooth;
}

.imageblock {
  max-height: 50vh;
  width: 100%;
  margin: 8px;

  display: flex;
  justify-content: center;

  .imageblock-inner {
    position: relative;

    img {
      max-height: 50vh;
      max-width: 50vw;
    }

    .imageblock-text {
      // TODO: make this appear properly if the text is wider than the image

      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;

      pointer-events: none;

      display: flex;
      align-items: flex-end;
      justify-content: center;

      color: white;

      padding-bottom: 16px;

      visibility: hidden;

      .imageblock-text-inner {
        padding: 4px 16px;
        background-color: #595959e6;
        border-radius: 10px;
        text-align: center;
        font-size: 12px;
      }
    }

    &:hover .imageblock-text {
      visibility: visible;
    }
  }
}

.image-gallery .content {
  display: flex;
  overflow-y: auto;

  .imageblock {
    // Without this the nested flexboxes get super screwy for some reason
    height: 25vh;
    // and this is required to make them not overlap with each other
    width: unset;

    .imageblock-inner img {
      max-height: 25vh;
    }
  }
}

.strike {
  text-decoration: line-through;
}

// Links targets target a small span above the header, to accomodate for the
// app bar's height
.adjusted-link-target-outer {
  position: relative;

  .adjusted-link-target {
    position: absolute;
    top: -(top-app-bar-variables.$row-height);
  }
}

@include if-mobile {
  .if-not-mobile {
    display: none;
  }
}

@include if-not-mobile() {
  .if-mobile {
    display: none;
  }
}

.tobii__btn {
  border-radius: 10px;
  --button-background: #00000080;
}

body {
  margin: 0;
  display: flex;
}

.post-section-header {
  margin: 12px 0;
}

a:not(.post-section-header-link):not(.mdc-list-item) {
  &,
  &:visited {
    color: var(--mdc-theme-secondary);
    text-decoration: none;
  }

  &:hover {
    text-decoration: underline;
  }
}

.post-section-header-link {
  vertical-align: middle;
}

@mixin simple-card {
  margin: 0 16px;
  padding: 16px;

  border: solid 1px var(--mdc-theme-on-primary);
  @include shape.radius($radius: medium);
}

pre {
  @include simple-card();

  font-family: 'Roboto Mono', monospace;
  overflow-y: auto;
}

.admonition {
  @include simple-card();

  display: inline-block;

  .admonition-name {
    text-transform: capitalize;
  }

  &.admonition-warning .admonition-name {
    color: var(--warning-color);
  }
}

#moot-logo a {
  z-index: 0 !important;
}

.mdc-top-app-bar {
  .mdc-top-app-bar__section {
    justify-content: space-between;
  }

  @include if-not-mobile {
    // Hide the nav icon on desktop.
    .mdc-top-app-bar__navigation-icon {
      display: none;
    }
  }

  @include if-mobile {
    .mdc-top-app-bar__title {
      // We want to center the title in the page, but its siblings on either side may not
      // have equal sizes. Thus, pull it out of the normal page flow, so it can be properly
      // centered.
      // The previous version of this site assigned each item a size of 33% which...worked,
      // but this is a bit nicer in that *only* the title needs to be modified.
      position: absolute;
      left: 50%;
      transform: translateX(-50%);

      // Remove the usual padding.
      padding-left: 0;
    }
  }

  .side-title {
    --mdc-typography-headline6-font-size: 1rem;
    padding-right: top-app-bar-variables.$title-left-padding;
  }
}

.mdc-drawer {
  position: fixed;
  height: 100vh;

  .mdc-drawer__header {
    .mdc-drawer__title {
      --mdc-typography-headline6-font-weight: normal;
      text-align: center;
    }

    @include if-not-mobile {
      display: none;
    }
  }

  @include if-not-mobile {
    // HACK: In order to avoid needing JS at the start on mobile,
    // we add mdc-drawer--modal on *all* viewports.
    // Then, the effects are reversed here on desktop via media query.
    display: initial !important;
    box-shadow: none !important;
    // Also make sure an open modal won't cause a gray background on rotate.
    & + .mdc-drawer-scrim {
      display: none !important;
    }

    // Make sure the navbar is always on top
    z-index: 0;
    // Based on mdc-top-app-bar.scss
    padding-top: top-app-bar-variables.$row-height;
  }
}

.mdc-drawer {
  .mdc-list-group__subheader {
    // Make sure the icon is aligned properly.
    @include list-mixins.item-base_;

    padding: 0 list-variables.$side-padding;
    padding-top: 16px;

    @include typography-mixins.typography(subtitle1);
  }

  .material-icons {
    color: var(--mdc-theme-secondary);
  }
}

.post-title {
  line-height: 1.2;
  margin: 0;
}

.post-subheader {
  margin-top: 0;
}

.page-outer {
  width: 100%;

  .page-content {
    margin: 16px;
    margin-top: 0;

    @include if-not-mobile {
      padding-left: drawer-variables.$width;
    }

    // For the loading transitions below
    // XXX: need to clean this up
    transition: opacity 0.2s linear;
  }
}

.paragraph {
  margin: 16px 0;
}

// XXX: this whole thing is insanely ugly

.loading {
  opacity: 0;
  transition: opacity 0.2s ease;
}

.loading-active {
  margin-top: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;

  position: fixed;
  width: 100%;
  opacity: 1;

  & + .page-content {
    opacity: 0;
  }

  .circle {
    display: inline-block;
    background-color: var(--mdc-theme-secondary);
    border: 1px solid var(--mdc-theme-secondary);
    border-radius: 50%;
  }

  .large-circle {
    margin: 0 20px;
    height: 50px;
    width: 50px;
    animation: loading 2s infinite;
  }

  .small-circle {
    height: 25px;
    width: 25px;
  }

  .left-circle {
    animation: left-movement 2s infinite;
  }

  .right-circle {
    animation: right-movement 2s infinite;
    margin-top: -27px;
  }

  @keyframes loading {
    0% {
      transform: translateY(100px);
    }
    50% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(100px);
    }
  }

  @keyframes left-movement {
    0% {
      transform: rotate(180deg) translateY(50px) rotate(180deg);
    }
    50% {
      transform: rotate(0deg) translateY(50px) rotate(0deg);
    }
    100% {
      transform: rotate(180deg) translateY(50px) rotate(180deg);
    }
  }

  @keyframes right-movement {
    0% {
      transform: rotate(0deg) translateY(-50px) rotate(0deg);
    }
    50% {
      transform: rotate(180deg) translateY(-50px) rotate(180deg);
    }
    100% {
      transform: rotate(0deg) translateY(-50px) rotate(0deg);
    }
  }
}
